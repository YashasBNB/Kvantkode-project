/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
import assert from 'assert';
import { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';
import { IssueReporterModel } from '../../browser/issueReporterModel.js';
import { normalizeGitHubUrl } from '../../common/issueReporterUtil.js';
suite('IssueReporter', () => {
    ensureNoDisposablesAreLeakedInTestSuite();
    test('sets defaults to include all data', () => {
        const issueReporterModel = new IssueReporterModel();
        assert.deepStrictEqual(issueReporterModel.getData(), {
            allExtensions: [],
            includeSystemInfo: true,
            includeExtensionData: true,
            includeWorkspaceInfo: true,
            includeProcessInfo: true,
            includeExtensions: true,
            includeExperiments: true,
            issueType: 0,
        });
    });
    test('serializes model skeleton when no data is provided', () => {
        const issueReporterModel = new IssueReporterModel({});
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:

Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('serializes GPU information when data is provided', () => {
        const issueReporterModel = new IssueReporterModel({
            issueType: 0,
            systemInfo: {
                os: 'Darwin',
                cpus: 'Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)',
                memory: '16.00GB',
                vmHint: '0%',
                processArgs: '',
                screenReader: 'no',
                remoteData: [],
                gpuStatus: {
                    '2d_canvas': 'enabled',
                    checker_imaging: 'disabled_off',
                },
            },
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:

<details>
<summary>System Info</summary>

|Item|Value|
|---|---|
|CPUs|Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)|
|GPU Status|2d_canvas: enabled<br>checker_imaging: disabled_off|
|Load (avg)|undefined|
|Memory (System)|16.00GB|
|Process Argv||
|Screen Reader|no|
|VM|0%|
</details>Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('serializes experiment info when data is provided', () => {
        const issueReporterModel = new IssueReporterModel({
            issueType: 0,
            systemInfo: {
                os: 'Darwin',
                cpus: 'Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)',
                memory: '16.00GB',
                vmHint: '0%',
                processArgs: '',
                screenReader: 'no',
                remoteData: [],
                gpuStatus: {
                    '2d_canvas': 'enabled',
                    checker_imaging: 'disabled_off',
                },
            },
            experimentInfo: 'vsliv695:30137379\nvsins829:30139715',
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:

<details>
<summary>System Info</summary>

|Item|Value|
|---|---|
|CPUs|Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)|
|GPU Status|2d_canvas: enabled<br>checker_imaging: disabled_off|
|Load (avg)|undefined|
|Memory (System)|16.00GB|
|Process Argv||
|Screen Reader|no|
|VM|0%|
</details>Extensions: none<details>
<summary>A/B Experiments</summary>

\`\`\`
vsliv695:30137379
vsins829:30139715
\`\`\`

</details>

<!-- generated by issue reporter -->`);
    });
    test('serializes Linux environment information when data is provided', () => {
        const issueReporterModel = new IssueReporterModel({
            issueType: 0,
            systemInfo: {
                os: 'Darwin',
                cpus: 'Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)',
                memory: '16.00GB',
                vmHint: '0%',
                processArgs: '',
                screenReader: 'no',
                remoteData: [],
                gpuStatus: {},
                linuxEnv: {
                    desktopSession: 'ubuntu',
                    xdgCurrentDesktop: 'ubuntu',
                    xdgSessionDesktop: 'ubuntu:GNOME',
                    xdgSessionType: 'x11',
                },
            },
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:

<details>
<summary>System Info</summary>

|Item|Value|
|---|---|
|CPUs|Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)|
|GPU Status||
|Load (avg)|undefined|
|Memory (System)|16.00GB|
|Process Argv||
|Screen Reader|no|
|VM|0%|
|DESKTOP_SESSION|ubuntu|
|XDG_CURRENT_DESKTOP|ubuntu|
|XDG_SESSION_DESKTOP|ubuntu:GNOME|
|XDG_SESSION_TYPE|x11|
</details>Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('serializes remote information when data is provided', () => {
        const issueReporterModel = new IssueReporterModel({
            issueType: 0,
            systemInfo: {
                os: 'Darwin',
                cpus: 'Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)',
                memory: '16.00GB',
                vmHint: '0%',
                processArgs: '',
                screenReader: 'no',
                gpuStatus: {
                    '2d_canvas': 'enabled',
                    checker_imaging: 'disabled_off',
                },
                remoteData: [
                    {
                        hostName: 'SSH: Pineapple',
                        machineInfo: {
                            os: 'Linux x64 4.18.0',
                            cpus: 'Intel(R) Xeon(R) CPU E5-2673 v4 @ 2.30GHz (2 x 2294)',
                            memory: '8GB',
                            vmHint: '100%',
                        },
                    },
                ],
            },
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:
Remote OS version: Linux x64 4.18.0

<details>
<summary>System Info</summary>

|Item|Value|
|---|---|
|CPUs|Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)|
|GPU Status|2d_canvas: enabled<br>checker_imaging: disabled_off|
|Load (avg)|undefined|
|Memory (System)|16.00GB|
|Process Argv||
|Screen Reader|no|
|VM|0%|

|Item|Value|
|---|---|
|Remote|SSH: Pineapple|
|OS|Linux x64 4.18.0|
|CPUs|Intel(R) Xeon(R) CPU E5-2673 v4 @ 2.30GHz (2 x 2294)|
|Memory (System)|8GB|
|VM|100%|
</details>Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('escapes backslashes in processArgs', () => {
        const issueReporterModel = new IssueReporterModel({
            issueType: 0,
            systemInfo: {
                os: 'Darwin',
                cpus: 'Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)',
                memory: '16.00GB',
                vmHint: '0%',
                processArgs: '\\\\HOST\\path',
                screenReader: 'no',
                remoteData: [],
                gpuStatus: {},
            },
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes:

<details>
<summary>System Info</summary>

|Item|Value|
|---|---|
|CPUs|Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 x 2800)|
|GPU Status||
|Load (avg)|undefined|
|Memory (System)|16.00GB|
|Process Argv|\\\\\\\\HOST\\\\path|
|Screen Reader|no|
|VM|0%|
</details>Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('should supply mode if applicable', () => {
        const issueReporterModel = new IssueReporterModel({
            isUnsupported: true,
            restrictedMode: true,
        });
        assert.strictEqual(issueReporterModel.serialize(), `
Type: <b>Bug</b>

undefined

VS Code version: undefined
OS version: undefined
Modes: Restricted, Unsupported

Extensions: none
<!-- generated by issue reporter -->`);
    });
    test('should normalize GitHub urls', () => {
        ;
        [
            'https://github.com/repo',
            'https://github.com/repo/',
            'https://github.com/repo.git',
            'https://github.com/repo/issues',
            'https://github.com/repo/issues/',
            'https://github.com/repo/issues/new',
            'https://github.com/repo/issues/new/',
        ].forEach((url) => {
            assert.strictEqual('https://github.com/repo', normalizeGitHubUrl(url));
        });
    });
    test('should have support for filing on extensions for bugs, performance issues, and feature requests', () => {
        ;
        [0 /* IssueType.Bug */, 2 /* IssueType.FeatureRequest */, 1 /* IssueType.PerformanceIssue */].forEach((type) => {
            const issueReporterModel = new IssueReporterModel({
                issueType: type,
                fileOnExtension: true,
            });
            assert.strictEqual(issueReporterModel.fileOnExtension(), true);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdFJlcG9ydGVyTW9kZWwudGVzdC5qcyIsInNvdXJjZVJvb3QiOiJmaWxlOi8vL1VzZXJzL3lhc2hhc25haWR1L0t2YW50Y29kZS92b2lkL3NyYy8iLCJzb3VyY2VzIjpbInZzL3dvcmtiZW5jaC9jb250cmliL2lzc3VlL3Rlc3QvYnJvd3Nlci90ZXN0UmVwb3J0ZXJNb2RlbC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Z0dBR2dHO0FBRWhHLE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQTtBQUMzQixPQUFPLEVBQUUsdUNBQXVDLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQTtBQUNsRyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQTtBQUV4RSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQTtBQUV0RSxLQUFLLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtJQUMzQix1Q0FBdUMsRUFBRSxDQUFBO0lBQ3pDLElBQUksQ0FBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUU7UUFDOUMsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLGtCQUFrQixFQUFFLENBQUE7UUFDbkQsTUFBTSxDQUFDLGVBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUNwRCxhQUFhLEVBQUUsRUFBRTtZQUNqQixpQkFBaUIsRUFBRSxJQUFJO1lBQ3ZCLG9CQUFvQixFQUFFLElBQUk7WUFDMUIsb0JBQW9CLEVBQUUsSUFBSTtZQUMxQixrQkFBa0IsRUFBRSxJQUFJO1lBQ3hCLGlCQUFpQixFQUFFLElBQUk7WUFDdkIsa0JBQWtCLEVBQUUsSUFBSTtZQUN4QixTQUFTLEVBQUUsQ0FBQztTQUNaLENBQUMsQ0FBQTtJQUNILENBQUMsQ0FBQyxDQUFBO0lBRUYsSUFBSSxDQUFDLG9EQUFvRCxFQUFFLEdBQUcsRUFBRTtRQUMvRCxNQUFNLGtCQUFrQixHQUFHLElBQUksa0JBQWtCLENBQUMsRUFBRSxDQUFDLENBQUE7UUFDckQs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