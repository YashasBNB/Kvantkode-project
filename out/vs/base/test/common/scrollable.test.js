/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
import assert from 'assert';
import { SmoothScrollingOperation } from '../../common/scrollable.js';
import { ensureNoDisposablesAreLeakedInTestSuite } from './utils.js';
class TestSmoothScrollingOperation extends SmoothScrollingOperation {
    constructor(from, to, viewportSize, startTime, duration) {
        duration = duration + 10;
        startTime = startTime - 10;
        super({ scrollLeft: 0, scrollTop: from, width: 0, height: viewportSize }, { scrollLeft: 0, scrollTop: to, width: 0, height: viewportSize }, startTime, duration);
    }
    testTick(now) {
        return this._tick(now);
    }
}
suite('SmoothScrollingOperation', () => {
    const VIEWPORT_HEIGHT = 800;
    const ANIMATION_DURATION = 125;
    const LINE_HEIGHT = 20;
    ensureNoDisposablesAreLeakedInTestSuite();
    function extractLines(scrollable, now) {
        const scrollTop = scrollable.testTick(now).scrollTop;
        const scrollBottom = scrollTop + VIEWPORT_HEIGHT;
        const startLineNumber = Math.floor(scrollTop / LINE_HEIGHT);
        const endLineNumber = Math.ceil(scrollBottom / LINE_HEIGHT);
        return [startLineNumber, endLineNumber];
    }
    function simulateSmoothScroll(from, to) {
        const scrollable = new TestSmoothScrollingOperation(from, to, VIEWPORT_HEIGHT, 0, ANIMATION_DURATION);
        const result = [];
        let resultLen = 0;
        result[resultLen++] = extractLines(scrollable, 0);
        result[resultLen++] = extractLines(scrollable, 25);
        result[resultLen++] = extractLines(scrollable, 50);
        result[resultLen++] = extractLines(scrollable, 75);
        result[resultLen++] = extractLines(scrollable, 100);
        result[resultLen++] = extractLines(scrollable, 125);
        return result;
    }
    function assertSmoothScroll(from, to, expected) {
        const actual = simulateSmoothScroll(from, to);
        assert.deepStrictEqual(actual, expected);
    }
    test('scroll 25 lines (40 fit)', () => {
        assertSmoothScroll(0, 500, [
            [5, 46],
            [14, 55],
            [20, 61],
            [23, 64],
            [24, 65],
            [25, 65],
        ]);
    });
    test('scroll 75 lines (40 fit)', () => {
        assertSmoothScroll(0, 1500, [
            [15, 56],
            [44, 85],
            [62, 103],
            [71, 112],
            [74, 115],
            [75, 115],
        ]);
    });
    test('scroll 100 lines (40 fit)', () => {
        assertSmoothScroll(0, 2000, [
            [20, 61],
            [59, 100],
            [82, 123],
            [94, 135],
            [99, 140],
            [100, 140],
        ]);
    });
    test('scroll 125 lines (40 fit)', () => {
        assertSmoothScroll(0, 2500, [
            [16, 57],
            [29, 70],
            [107, 148],
            [119, 160],
            [124, 165],
            [125, 165],
        ]);
    });
    test('scroll 500 lines (40 fit)', () => {
        assertSmoothScroll(0, 10000, [
            [16, 57],
            [29, 70],
            [482, 523],
            [494, 535],
            [499, 540],
            [500, 540],
        ]);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsYWJsZS50ZXN0LmpzIiwic291cmNlUm9vdCI6ImZpbGU6Ly8vVXNlcnMveWFzaGFzbmFpZHUvS3ZhbnRjb2RlL0t2YW50a29kZS1wcm9qZWN0L0t2YW50a29kZS9zcmMvIiwic291cmNlcyI6WyJ2cy9iYXNlL3Rlc3QvY29tbW9uL3Njcm9sbGFibGUudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O2dHQUdnRztBQUVoRyxPQUFPLE1BQU0sTUFBTSxRQUFRLENBQUE7QUFDM0IsT0FBTyxFQUFFLHdCQUF3QixFQUF5QixNQUFNLDRCQUE0QixDQUFBO0FBQzVGLE9BQU8sRUFBRSx1Q0FBdUMsRUFBRSxNQUFNLFlBQVksQ0FBQTtBQUVwRSxNQUFNLDRCQUE2QixTQUFRLHdCQUF3QjtJQUNsRSxZQUFZLElBQVksRUFBRSxFQUFVLEVBQUUsWUFBb0IsRUFBRSxTQUFpQixFQUFFLFFBQWdCO1FBQzlGLFFBQVEsR0FBRyxRQUFRLEdBQUcsRUFBRSxDQUFBO1FBQ3hCLFNBQVMsR0FBRyxTQUFTLEdBQUcsRUFBRSxDQUFBO1FBRTFCLEtBQUssQ0FDSixFQUFFLFVBQVUsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsRUFDbEUsRUFBRSxVQUFVLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLEVBQ2hFLFNBQVMsRUFDVCxRQUFRLENBQ1IsQ0FBQTtJQUNGLENBQUM7SUFFTSxRQUFRLENBQUMsR0FBVztRQUMxQixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDdkIsQ0FBQztDQUNEO0FBRUQsS0FBSyxDQUFDLDBCQUEwQixFQUFFLEdBQUcsRUFBRTtJQUN0QyxNQUFNLGVBQWUsR0FBRyxHQUFHLENBQUE7SUFDM0IsTUFBTSxrQkFBa0IsR0FB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RixJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO1FBQ3RDLGtCQUFrQixDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUU7WUFDM0IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDO1lBQ1QsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDO1lBQ1QsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDO1lBQ1QsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDO1lBQ1QsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1NBQ1YsQ0FBQyxDQUFBO0lBQ0gsQ0FBQyxDQUFDLENBQUE7SUFFRixJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO1FBQ3RDLGtCQUFrQixDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUU7WUFDM0IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1NBQ1YsQ0FBQyxDQUFBO0lBQ0gsQ0FBQyxDQUFDLENBQUE7SUFFRixJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO1FBQ3RDLGtCQUFrQixDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUU7WUFDNUIsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQ1IsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1NBQ1YsQ0FBQyxDQUFBO0lBQ0gsQ0FBQyxDQUFDLENBQUE7QUFDSCxDQUFDLENBQUMsQ0FBQSJ9